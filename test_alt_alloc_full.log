
========================================
CUDA ZSTD - Alternative Allocation Strategies Test Suite
========================================

Using CUDA device: NVIDIA GeForce RTX 5080 Laptop GPU
Compute capability: 12.0
Total memory: 16302 MB
========================================
SUITE 1: Smart Allocation Algorithms
========================================

[TEST] Smart Allocation Interface
MemoryPoolManager::allocate_from_cuda: trying cudaMalloc size=1048576
MemoryPoolManager::allocate_from_cuda: cudaMalloc returned err=0 ptr=0x90ba00000
  [INFO] Smart allocation succeeded: 1048576 bytes
  [INFO]   Strategy used: 0
  [INFO]   Is enhanced: No
  [INFO]   Is dual memory: No
  [PASS] Smart Allocation Interface

[TEST] Allocation Strategy Selection
MemoryPoolManager::allocate_from_cuda: trying cudaMalloc size=524288
MemoryPoolManager::allocate_from_cuda: cudaMalloc returned err=0 ptr=0x90ba00000
  [INFO] Strategy AUTO_ADAPTIVE succeeded: 524288 bytes
  [INFO]   Is host memory: No
MemoryPoolManager::allocate_from_cuda: trying cudaMalloc size=524288
MemoryPoolManager::allocate_from_cuda: cudaMalloc returned err=0 ptr=0x90ba00000
  [INFO] Strategy PREFER_GPU succeeded: 524288 bytes
  [INFO]   Is host memory: No
MemoryPoolManager::allocate_from_host: host allocation ptr=0x204c00000 size=524288
  [INFO] Strategy PREFER_HOST succeeded: 524288 bytes
  [INFO]   Is host memory: Yes
MemoryPoolManager::deallocate: cudaFree failed for tracked ptr=0x204c00000 err=1
  [FAIL] test_allocation_strategy_selection: Deallocation failed for strategy PREFER_HOST Status: ERROR_CUDA_ERROR

[TEST] Dual Memory Allocation
MemoryPoolManager::allocate_from_cuda: trying cudaMalloc size=262144
MemoryPoolManager::allocate_from_cuda: cudaMalloc returned err=0 ptr=0x90ba00000
MemoryPoolManager::allocate_from_host: host allocation ptr=0x204c80000 size=262144
  [INFO] Dual memory allocation succeeded
  [INFO]   GPU allocation: Yes
  [INFO]   Host allocation: Yes
  [INFO]   Effective size: 0 bytes
  [INFO]   Is dual memory: Yes
debug_free: freeing host ptr=0x204c80000
debug_free: stacktrace:
./test_alternative_allocation_strategies(+0x28f59) [0x56e6781b0f59]
./test_alternative_allocation_strategies(+0x2910c) [0x56e6781b110c]
./test_alternative_allocation_strategies(+0x1a168) [0x56e6781a2168]
./test_alternative_allocation_strategies(+0x93f6) [0x56e6781913f6]
./test_alternative_allocation_strategies(+0xc7d4) [0x56e6781947d4]
/lib/x86_64-linux-gnu/libc.so.6(+0x2a1ca) [0x75677c22a1ca]
/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0x8b) [0x75677c22a28b]
./test_alternative_allocation_strategies(+0x62f5) [0x56e67818e2f5]

free(): invalid pointer
